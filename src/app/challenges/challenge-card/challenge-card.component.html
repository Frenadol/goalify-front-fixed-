<mat-card class="challenge-mat-card" [class.joined-card]="isJoined">
  <mat-card-header>
    <div mat-card-avatar class="challenge-avatar">
      <!-- CAMBIO: Eliminada la referencia a challenge.icono -->
      <mat-icon>emoji_events</mat-icon>
    </div>
    <mat-card-title>{{ challenge.nombre }}</mat-card-title>
    <mat-card-subtitle>{{ challenge.categoria }}</mat-card-subtitle>
  </mat-card-header>
  <!-- CAMBIO: de imagenUrl a imageUrl -->
  <img mat-card-image *ngIf="challenge.imageUrl" [src]="challenge.imageUrl" alt="Imagen de {{ challenge.nombre }}">
  <mat-card-content>
    <p class="challenge-description">{{ challenge.descripcion }}</p>
    <div class="challenge-details">
      <!-- CAMBIO: Eliminada la línea de dificultad -->
      <span><strong>Puntos:</strong> {{ challenge.puntosRecompensa }}</span>
      <span *ngIf="challenge.fechaInicio"><strong>Inicio:</strong> {{ challenge.fechaInicio | date:'dd/MM/yyyy' }}</span>
      <span *ngIf="challenge.fechaFin"><strong>Fin:</strong> {{ challenge.fechaFin | date:'dd/MM/yyyy' }}</span>
    </div>
  </mat-card-content>
  <mat-card-actions class="challenge-actions">
    <ng-container *ngIf="!isJoined && !isAdmin">
      <button mat-flat-button color="primary" (click)="joinChallenge()" [disabled]="isJoining">
        <mat-spinner *ngIf="isJoining" diameter="20" class="button-spinner"></mat-spinner>
        <span *ngIf="!isJoining">¡Aceptar Desafío!</span>
        <span *ngIf="isJoining">Uniéndote...</span>
      </button>
    </ng-container>

    <ng-container *ngIf="isJoined && !isAdmin">
      <button mat-stroked-button color="warn" (click)="leaveChallenge()" [disabled]="isLeaving" matTooltip="Abandonar este desafío">
        <mat-spinner *ngIf="isLeaving" diameter="20" class="button-spinner"></mat-spinner>
        <mat-icon *ngIf="!isLeaving">exit_to_app</mat-icon>
        <span *ngIf="!isLeaving">Abandonar</span>
        <span *ngIf="isLeaving">Abandonando...</span>
      </button>
      <button mat-flat-button color="accent" disabled class="already-joined-button">
        <mat-icon>check_circle</mat-icon>
        ¡Participando!
      </button>
    </ng-container>

    <!-- BOTONES DE ADMINISTRADOR -->
    <ng-container *ngIf="isAdmin">
      <!-- BOTÓN DE EDITAR (NUEVO) -->
      <button mat-icon-button color="primary" [routerLink]="['/admin/challenges/edit', challenge.id]" matTooltip="Editar desafío (Admin)">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-icon-button color="warn" (click)="confirmDeleteChallenge()" [disabled]="isDeleting" matTooltip="Eliminar desafío (Admin)">
        <mat-spinner *ngIf="isDeleting" diameter="20" class="button-spinner"></mat-spinner>
        <mat-icon *ngIf="!isDeleting">delete_forever</mat-icon>
      </button>
    </ng-container>
  </mat-card-actions>
  <div *ngIf="actionError" class="action-error-message">
    <mat-icon>warning</mat-icon> {{ actionError }}
  </div>
</mat-card>